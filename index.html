<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0b1220">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Financiero Personal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js desde CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ===== RESET Y VARIABLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        :root {
            --primary-color: #0066ff;
            --primary-dark: #0052d4;
            --secondary-color: #667085;
            --success-color: #00c853;
            --warning-color: #ffab00;
            --danger-color: #ff3d00;
            --info-color: #00b8d4;
            --light-color: #ffffff;
            --dark-color: #1a1a1a;
            --gray-light: #f5f5f5;
            --gray: #b0b0b0;
            --border-radius: 16px;
            --box-shadow: 0 8px 32px rgba(0, 102, 255, 0.1);
            --box-shadow-glow: 0 0 30px rgba(0, 102, 255, 0.3);
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(255, 255, 255, 0.3);
            --glass-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            --gradient-primary: linear-gradient(135deg, #0066ff 0%, #0052d4 100%);
            --gradient-success: linear-gradient(135deg, #00c853 0%, #00b248 100%);
            --gradient-danger: linear-gradient(135deg, #ff3d00 0%, #dd2c00 100%);
            --gradient-warning: linear-gradient(135deg, #ffab00 0%, #ff8f00 100%);
            --gradient-glass: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
        }

        body {
            background: linear-gradient(135deg, #f8faff 0%, #f0f4ff 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 30px;
        }

        /* ===== ANIMACIONES GLOBALES ===== */
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(0, 102, 255, 0.2);
            }
            50% { 
                box-shadow: 0 0 40px rgba(0, 102, 255, 0.4);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .fade-in {
            animation: fadeIn 1s ease-out forwards;
        }

        .slide-up {
            animation: slideUp 0.8s ease-out forwards;
        }

        /* ===== HEADER ===== */
        header {
            background: var(--gradient-primary);
            color: white;
            padding: 25px 0;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 2;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            animation: pulse 4s infinite;
        }

        .logo i {
            font-size: 2.2rem;
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5));
            animation: float 6s infinite ease-in-out;
        }

        .logo h1 {
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, #ffffff 0%, #e6f2ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        /* ===== BOTONES ===== */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
            background: var(--gradient-glass);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.4), 
                transparent);
            transition: left 0.7s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: var(--box-shadow-glow);
        }

        .btn:active {
            transform: translateY(-2px) scale(1.02);
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0052d4 0%, #0041b2 100%);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #00b248 0%, #009624 100%);
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #dd2c00 0%, #c62828 100%);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .btn-sm {
            padding: 10px 20px;
            font-size: 0.9rem;
        }

        /* ===== SECCIONES Y TÍTULOS ===== */
        section {
            margin-bottom: 60px;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 1s ease, transform 1s ease;
        }

        section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .section-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 102, 255, 0.1);
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 150px;
            height: 3px;
            background: var(--gradient-primary);
            animation: glow 2s infinite;
            border-radius: 3px;
        }

        .section-title h2 {
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--dark-color);
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--dark-color) 0%, #3d3d3d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-title i {
            color: var(--primary-color);
            filter: drop-shadow(0 0 10px rgba(0, 102, 255, 0.3));
            font-size: 1.6rem;
        }

        /* ===== RESUMEN FINANCIERO ===== */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
        }

        .summary-card {
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            transform-style: preserve-3d;
            perspective: 1000px;
            animation: slideUp 0.6s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .summary-card:hover {
            transform: translateY(-15px) rotateX(10deg);
            box-shadow: var(--box-shadow-glow);
        }

        .summary-card.positive {
            border-top: 4px solid var(--success-color);
        }

        .summary-card.negative {
            border-top: 4px solid var(--danger-color);
        }

        .summary-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .summary-card-header h3 {
            font-size: 1.1rem;
            color: var(--secondary-color);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card-header i {
            font-size: 1.8rem;
            color: var(--primary-color);
            transition: var(--transition);
            filter: drop-shadow(0 0 10px rgba(0, 102, 255, 0.3));
        }

        .summary-card:hover .summary-card-header i {
            transform: scale(1.3) rotate(15deg);
            color: var(--primary-dark);
        }

        .summary-amount {
            font-size: 2.8rem;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 20px rgba(0, 102, 255, 0.2);
            line-height: 1;
        }

        .summary-period {
            color: var(--secondary-color);
            font-size: 0.95rem;
            font-weight: 500;
            opacity: 0.9;
        }

        /* ===== NUEVA SECCIÓN: ANÁLISIS VISUAL ===== */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }

        .chart-container {
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            animation: slideUp 0.8s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--info-color));
        }

        .chart-container:hover {
            transform: translateY(-10px);
            box-shadow: var(--box-shadow-glow);
        }

        .chart-container h3 {
            margin-bottom: 25px;
            color: var(--dark-color);
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chart-container h3 i {
            color: var(--primary-color);
            font-size: 1.4rem;
        }

        .chart-wrapper {
            position: relative;
            height: 320px;
            width: 100%;
        }

        /* ===== NUEVA SECCIÓN: CENTRO DE CONOCIMIENTO ===== */
        .knowledge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }

        .knowledge-card {
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            animation: slideUp 0.7s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        .knowledge-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--warning-color), var(--success-color));
        }

        .knowledge-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--box-shadow-glow);
        }

        .knowledge-card h3 {
            margin-bottom: 20px;
            color: var(--dark-color);
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .knowledge-card h3 i {
            color: var(--warning-color);
            font-size: 1.4rem;
        }

        .book-list, .concept-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .book-item, .concept-item {
            padding: 20px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            border: 1px solid rgba(0, 102, 255, 0.1);
            transition: var(--transition);
        }

        .book-item:hover, .concept-item:hover {
            transform: translateX(10px);
            background: rgba(255, 255, 255, 0.8);
            border-color: rgba(0, 102, 255, 0.3);
        }

        .book-title {
            font-weight: 700;
            color: var(--dark-color);
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .book-author {
            color: var(--secondary-color);
            font-size: 0.9rem;
            margin-bottom: 10px;
            font-style: italic;
        }

        .book-description {
            color: var(--secondary-color);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .concept-title {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .concept-description {
            color: var(--secondary-color);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* ===== NUEVA SECCIÓN: SUGERENCIAS INTELIGENTES ===== */
        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .suggestion-card {
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            animation: slideUp 0.6s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        .suggestion-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--info-color), var(--success-color));
        }

        .suggestion-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--box-shadow-glow);
        }

        .suggestion-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .suggestion-icon {
            font-size: 1.8rem;
            color: var(--info-color);
            filter: drop-shadow(0 0 10px rgba(0, 184, 212, 0.3));
            animation: float 3s infinite ease-in-out;
        }

        .suggestion-header h3 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        .suggestion-content p {
            color: var(--secondary-color);
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .suggestion-action {
            display: inline-block;
            padding: 8px 16px;
            background: rgba(0, 102, 255, 0.1);
            color: var(--primary-color);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
        }

        .suggestion-action:hover {
            background: rgba(0, 102, 255, 0.2);
            transform: scale(1.05);
        }

        /* ===== TABLAS ===== */
        .table-container {
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
            overflow-x: auto;
            transition: var(--transition);
            animation: slideUp 0.7s ease-out forwards;
        }

        .table-container:hover {
            box-shadow: var(--box-shadow-glow);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: transparent;
        }

        thead {
            background: var(--gradient-primary);
            color: white;
        }

        th {
            padding: 20px 15px;
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
            font-size: 1rem;
        }

        th::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
        }

        tbody tr {
            border-bottom: 1px solid rgba(0, 102, 255, 0.1);
            transition: var(--transition);
            background: transparent;
        }

        tbody tr:hover {
            background: rgba(0, 102, 255, 0.05);
            transform: translateX(10px);
        }

        td {
            padding: 18px;
            vertical-align: middle;
            background: transparent;
        }

        .positive-number {
            color: var(--success-color);
            font-weight: 700;
            position: relative;
            font-size: 1.1rem;
        }

        .positive-number::before {
            content: '▲';
            margin-right: 8px;
            animation: float 2s infinite;
            font-size: 0.9rem;
        }

        .negative-number {
            color: var(--danger-color);
            font-weight: 700;
            position: relative;
            font-size: 1.1rem;
        }

        .negative-number::before {
            content: '▼';
            margin-right: 8px;
            font-size: 0.9rem;
        }

        .badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: var(--transition);
            border: 1px solid transparent;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .badge:hover {
            transform: scale(1.05);
        }

        .badge-income {
            background: rgba(0, 200, 83, 0.15);
            color: var(--success-color);
            border-color: rgba(0, 200, 83, 0.3);
        }

        .badge-expense {
            background: rgba(255, 61, 0, 0.15);
            color: var(--danger-color);
            border-color: rgba(255, 61, 0, 0.3);
        }

        .badge-warning {
            background: rgba(255, 171, 0, 0.15);
            color: var(--warning-color);
            border-color: rgba(255, 171, 0, 0.3);
            animation: pulse 2s infinite;
        }

        /* ===== FORMULARIOS ===== */
        .form-card {
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
            margin-bottom: 40px;
            transition: var(--transition);
            animation: slideUp 0.8s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        .form-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--info-color));
        }

        .form-card:hover {
            box-shadow: var(--box-shadow-glow);
        }

        .form-row {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

        .form-group {
            flex: 1;
            min-width: 220px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 1rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 1rem;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: var(--dark-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 102, 255, 0.1);
            background: white;
            transform: translateY(-3px);
        }

        .radio-group {
            display: flex;
            gap: 25px;
            margin-top: 15px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 15px 20px;
            border-radius: 12px;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid transparent;
            flex: 1;
        }

        .radio-option:hover {
            background: rgba(0, 102, 255, 0.1);
            border-color: rgba(0, 102, 255, 0.3);
            transform: translateY(-3px);
        }

        .radio-option input {
            width: auto;
            transform: scale(1.2);
        }

        /* ===== ANÁLISIS Y ALERTAS ===== */
        .alerts-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .alert-card {
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: flex-start;
            gap: 20px;
            border-left: 5px solid var(--warning-color);
            transition: var(--transition);
            animation: slideUp 0.6s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        .alert-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--box-shadow-glow);
        }

        .alert-card.success {
            border-left-color: var(--success-color);
        }

        .alert-card.danger {
            border-left-color: var(--danger-color);
        }

        .alert-card.info {
            border-left-color: var(--info-color);
        }

        .alert-icon {
            font-size: 2rem;
            margin-top: 5px;
            animation: float 4s infinite ease-in-out;
        }

        .alert-card.success .alert-icon {
            color: var(--success-color);
            filter: drop-shadow(0 0 15px rgba(0, 200, 83, 0.3));
        }

        .alert-card.danger .alert-icon {
            color: var(--danger-color);
            filter: drop-shadow(0 0 15px rgba(255, 61, 0, 0.3));
        }

        .alert-card.info .alert-icon {
            color: var(--info-color);
            filter: drop-shadow(0 0 15px rgba(0, 184, 212, 0.3));
        }

        .alert-content h4 {
            margin-bottom: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        .alert-content p {
            color: var(--secondary-color);
            font-size: 1rem;
            line-height: 1.6;
        }

        /* ===== HÁBITOS ===== */
        .habits-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 30px;
        }

        .habits-column {
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            animation: slideUp 0.7s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        .habits-column:hover {
            transform: translateY(-10px);
            box-shadow: var(--box-shadow-glow);
        }

        .habits-column.bad-habits {
            border-top: 4px solid var(--danger-color);
        }

        .habits-column.good-habits {
            border-top: 4px solid var(--success-color);
        }

        .habits-column-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 102, 255, 0.1);
        }

        .habits-column-title h3 {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .habits-list {
            margin-bottom: 30px;
        }

        .habit-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 18px 0;
            border-bottom: 1px solid rgba(0, 102, 255, 0.1);
            transition: var(--transition);
        }

        .habit-item:hover {
            transform: translateX(15px);
            background: rgba(0, 102, 255, 0.05);
            border-radius: 12px;
            padding-left: 15px;
            padding-right: 15px;
        }

        .habit-item:last-child {
            border-bottom: none;
        }

        .habit-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            transition: var(--transition);
            accent-color: var(--primary-color);
        }

        .habit-checkbox:hover {
            transform: scale(1.3);
            filter: drop-shadow(0 0 10px rgba(0, 102, 255, 0.3));
        }

        .habit-text {
            flex: 1;
            font-size: 1.05rem;
            transition: var(--transition);
        }

        .habit-item.completed .habit-text {
            text-decoration: line-through;
            color: var(--gray);
            opacity: 0.6;
        }

        .streak-counter {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: rgba(0, 102, 255, 0.1);
            border-radius: var(--border-radius);
            margin-top: 25px;
            border: 1px solid rgba(0, 102, 255, 0.2);
            animation: glow 3s infinite;
        }

        .streak-counter i {
            color: var(--warning-color);
            font-size: 2rem;
            animation: pulse 2s infinite;
            filter: drop-shadow(0 0 15px rgba(255, 171, 0, 0.3));
        }

        /* ===== PLAN DIARIO ===== */
        .time-blocks-container {
            background: var(--gradient-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--glass-shadow);
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            animation: slideUp 0.8s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        .time-blocks-container:hover {
            box-shadow: var(--box-shadow-glow);
        }

        .time-block {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            border-bottom: 1px solid rgba(0, 102, 255, 0.1);
            transition: var(--transition);
        }

        .time-block:hover {
            background: rgba(0, 102, 255, 0.05);
            border-radius: 12px;
            transform: translateX(10px);
        }

        .time-block:last-child {
            border-bottom: none;
        }

        .time-range {
            min-width: 180px;
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .time-activity {
            flex: 1;
        }

        .time-activity input {
            border: none;
            background: transparent;
            font-size: 1.1rem;
            padding: 0;
            transition: var(--transition);
            width: 100%;
            color: var(--dark-color);
        }

        .time-activity input:focus {
            border: 2px solid var(--primary-color);
            padding: 12px;
            border-radius: 12px;
            background: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0, 102, 255, 0.1);
        }

        .productivity-meter {
            margin-top: 30px;
            padding: 25px;
            background: rgba(0, 102, 255, 0.1);
            border-radius: var(--border-radius);
            border: 1px solid rgba(0, 102, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .productivity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .productivity-header h3 {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        .productivity-header span {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            animation: pulse 2s infinite;
        }

        .progress-bar {
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-success);
            border-radius: 12px;
            transition: width 2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
            box-shadow: 0 0 20px rgba(0, 200, 83, 0.3);
        }

        /* ===== UTILIDADES ===== */
        .text-success {
            color: var(--success-color);
            font-weight: 700;
        }

        .text-danger {
            color: var(--danger-color);
            font-weight: 700;
        }

        .text-warning {
            color: var(--warning-color);
            font-weight: 700;
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
            padding: 8px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            transform: scale(1.3) rotate(90deg);
            background: rgba(255, 61, 0, 0.1);
            box-shadow: 0 0 20px rgba(255, 61, 0, 0.3);
        }

        /* ===== NOTIFICACIÓN ===== */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 20px 30px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 700;
            box-shadow: var(--box-shadow-glow);
            z-index: 1000;
            animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            max-width: 400px;
            transform-style: preserve-3d;
        }

        .notification-success {
            background: var(--gradient-success);
        }

        .notification-error {
            background: var(--gradient-danger);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%) translateY(30px) rotateX(90deg);
                opacity: 0;
            }
            to {
                transform: translateX(0) translateY(0) rotateX(0);
                opacity: 1;
            }
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .charts-grid,
            .knowledge-grid,
            .suggestions-grid {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 20px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 25px;
                text-align: center;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid,
            .knowledge-grid,
            .suggestions-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .habits-container {
                grid-template-columns: 1fr;
            }
            
            .section-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .time-range {
                min-width: 140px;
            }
            
            .chart-container {
                padding: 20px;
            }
            
            .chart-wrapper {
                height: 280px;
            }
            
            .notification {
                left: 20px;
                right: 20px;
                bottom: 20px;
                max-width: none;
            }
        }

        @media (max-width: 480px) {
            .btn {
                padding: 12px 20px;
                font-size: 0.9rem;
            }
            
            .summary-amount {
                font-size: 2.2rem;
            }
            
            .chart-wrapper {
                height: 250px;
            }
            
            .knowledge-card,
            .suggestion-card {
                padding: 20px;
            }
        }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.4s ease-out;
        }

        .modal-content {
            background: var(--gradient-glass);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            padding: 40px;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            box-shadow: var(--box-shadow-glow);
            border: 1px solid var(--glass-border);
            animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 20px;
            margin-top: 30px;
        }

        /* ===== SCROLL PERSONALIZADO ===== */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 102, 255, 0.05);
            border-radius: 10px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient-primary);
            border-radius: 10px;
            transition: var(--transition);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            box-shadow: 0 0 20px rgba(0, 102, 255, 0.5);
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-chart-network"></i>
                <h1>Dashboard Financiero Pro</h1>
            </div>
            <div class="header-actions">
                <button class="btn btn-outline" id="exportBtn">
                    <i class="fas fa-file-export"></i> Exportar JSON
                </button>
                <button class="btn btn-danger" id="clearMonthBtn">
                    <i class="fas fa-calendar-times"></i> Reiniciar Mes
                </button>
                <button class="btn btn-danger" id="clearAllBtn">
                    <i class="fas fa-trash-alt"></i> Limpiar Todo
                </button>
            </div>
        </div>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="container">
        <!-- SECCIÓN 1: RESUMEN FINANCIERO GENERAL -->
        <section id="resumen" class="visible">
            <div class="section-title">
                <h2><i class="fas fa-chart-bar"></i> Resumen Financiero General</h2>
                <div class="current-date" id="currentDate"></div>
            </div>
            
            <div class="summary-grid">
                <!-- Tarjetas se generarán dinámicamente con JavaScript -->
            </div>
        </section>

        <!-- NUEVA SECCIÓN 2: ANÁLISIS VISUAL -->
        <section id="analisis-visual">
            <div class="section-title">
                <h2><i class="fas fa-chart-line"></i> Análisis Visual</h2>
                <button class="btn btn-primary btn-sm" id="refreshChartsBtn">
                    <i class="fas fa-sync-alt"></i> Actualizar Gráficos
                </button>
            </div>
            
            <div class="charts-grid">
                <!-- Gráfico de líneas: Ingresos vs Gastos -->
                <div class="chart-container">
                    <h3><i class="fas fa-chart-line"></i> Ingresos vs Gastos por Mes</h3>
                    <div class="chart-wrapper">
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>
                
                <!-- Gráfico circular: Distribución de gastos -->
                <div class="chart-container">
                    <h3><i class="fas fa-chart-pie"></i> Distribución de Gastos</h3>
                    <div class="chart-wrapper">
                        <canvas id="pieChart"></canvas>
                    </div>
                </div>
                
                <!-- Gráfico tipo velas: Balance diario -->
                <div class="chart-container">
                    <h3><i class="fas fa-chart-candlestick"></i> Balance Diario</h3>
                    <div class="chart-wrapper">
                        <canvas id="candlestickChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECCIÓN 3: ESTADO DE RESULTADOS MENSUAL -->
        <section id="estado-resultados">
            <div class="section-title">
                <h2><i class="fas fa-file-invoice-dollar"></i> Estado de Resultados Mensual</h2>
                <button class="btn btn-primary btn-sm" id="addMonthBtn">
                    <i class="fas fa-plus"></i> Agregar Mes
                </button>
            </div>
            
            <div class="table-container">
                <table id="monthlyResultsTable">
                    <thead>
                        <tr>
                            <th>Mes</th>
                            <th>Total Ingresos</th>
                            <th>Total Gastos</th>
                            <th>Resultado (Ahorro/Déficit)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Filas se generarán dinámicamente -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- SECCIÓN 4: GASTOS POR CATEGORÍA -->
        <section id="gastos-categoria">
            <div class="section-title">
                <h2><i class="fas fa-chart-pie"></i> Gastos por Categoría (Mes Actual)</h2>
            </div>
            
            <div class="table-container">
                <table id="categoryExpensesTable">
                    <thead>
                        <tr>
                            <th>Categoría</th>
                            <th>Total Gastado</th>
                            <th>Porcentaje del Total</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Filas se generarán dinámicamente -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- NUEVA SECCIÓN 5: CENTRO DE CONOCIMIENTO -->
        <section id="centro-conocimiento">
            <div class="section-title">
                <h2><i class="fas fa-graduation-cap"></i> Educación Financiera y Empresarial</h2>
            </div>
            
            <div class="knowledge-grid">
                <!-- Libros Recomendados -->
                <div class="knowledge-card">
                    <h3><i class="fas fa-book"></i> Libros Recomendados</h3>
                    <div class="book-list" id="bookList">
                        <!-- Libros se generarán dinámicamente -->
                    </div>
                </div>
                
                <!-- Conceptos Importantes -->
                <div class="knowledge-card">
                    <h3><i class="fas fa-lightbulb"></i> Conceptos Importantes</h3>
                    <div class="concept-list" id="conceptList">
                        <!-- Conceptos se generarán dinámicamente -->
                    </div>
                </div>
            </div>
        </section>

        <!-- SECCIÓN 6: REGISTRO DE MOVIMIENTOS -->
        <section id="registro-movimientos">
            <div class="section-title">
                <h2><i class="fas fa-book"></i> Registro de Movimientos (Libro Diario)</h2>
            </div>
            
            <!-- Formulario de registro -->
            <div class="form-card">
                <h3 style="margin-bottom: 20px;">Nuevo Movimiento</h3>
                <form id="transactionForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="transactionType">Tipo *</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="type" value="income" required> Ingreso
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="type" value="expense" required> Gasto
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="amount">Monto ($) *</label>
                            <input type="number" id="amount" min="0" step="0.01" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="category">Categoría *</label>
                            <select id="category" required>
                                <option value="">Seleccionar categoría</option>
                                <optgroup label="Ingresos">
                                    <option value="salario">Salario</option>
                                    <option value="freelance">Freelance</option>
                                    <option value="inversiones">Inversiones</option>
                                    <option value="otros-ingresos">Otros ingresos</option>
                                </optgroup>
                                <optgroup label="Gastos">
                                    <option value="alimentacion">Alimentación</option>
                                    <option value="transporte">Transporte</option>
                                    <option value="servicios">Servicios</option>
                                    <option value="educacion">Educación</option>
                                    <option value="entretenimiento">Entretenimiento</option>
                                    <option value="gastos-hormiga">Gastos hormiga</option>
                                    <option value="otros-gastos">Otros gastos</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="description">Descripción</label>
                            <textarea id="description" rows="2" placeholder="Descripción del movimiento"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="date">Fecha *</label>
                            <input type="date" id="date" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Registrar Movimiento
                    </button>
                </form>
            </div>
            
            <!-- Tabla de movimientos -->
            <div class="table-container">
                <table id="transactionsTable">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>Categoría</th>
                            <th>Descripción</th>
                            <th>Monto</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Filas se generarán dinámicamente -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- NUEVA SECCIÓN 7: SUGERENCIAS INTELIGENTES -->
        <section id="sugerencias-inteligentes">
            <div class="section-title">
                <h2><i class="fas fa-robot"></i> Recomendaciones Inteligentes</h2>
                <button class="btn btn-success btn-sm" id="refreshSuggestionsBtn">
                    <i class="fas fa-brain"></i> Analizar Datos
                </button>
            </div>
            
            <div class="suggestions-grid" id="suggestionsContainer">
                <!-- Sugerencias se generarán dinámicamente -->
            </div>
        </section>

        <!-- SECCIÓN 8: ANÁLISIS AUTOMÁTICO Y ALERTAS -->
        <section id="analisis-alertas">
            <div class="section-title">
                <h2><i class="fas fa-exclamation-circle"></i> Análisis Automático y Alertas</h2>
            </div>
            
            <div class="alerts-container" id="alertsContainer">
                <!-- Alertas se generarán dinámicamente -->
            </div>
        </section>

        <!-- SECCIÓN 9: HÁBITOS -->
        <section id="habitos">
            <div class="section-title">
                <h2><i class="fas fa-brain"></i> Hábitos: De Malos a Buenos</h2>
                <button class="btn btn-success" id="showSuggestionsBtn">
                    <i class="fas fa-lightbulb"></i> Ver Sugerencias
                </button>
            </div>
            
            <div class="habits-container">
                <!-- Columna de malos hábitos -->
                <div class="habits-column bad-habits">
                    <div class="habits-column-title">
                        <i class="fas fa-times-circle text-danger"></i>
                        <h3>Malos Hábitos</h3>
                    </div>
                    
                    <div class="habits-list" id="badHabitsList">
                        <!-- Hábitos se generarán dinámicamente -->
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" id="newBadHabit" placeholder="Agregar nuevo mal hábito">
                        </div>
                        <button class="btn btn-outline" id="addBadHabitBtn">
                            <i class="fas fa-plus"></i> Agregar
                        </button>
                    </div>
                </div>
                
                <!-- Columna de buenos hábitos -->
                <div class="habits-column good-habits">
                    <div class="habits-column-title">
                        <i class="fas fa-check-circle text-success"></i>
                        <h3>Buenos Hábitos Sugeridos</h3>
                    </div>
                    
                    <div class="habits-list" id="goodHabitsList">
                        <!-- Hábitos se generarán dinámicamente -->
                    </div>
                    
                    <div class="streak-counter">
                        <i class="fas fa-fire"></i>
                        <div>
                            <h4>Racha Actual</h4>
                            <p id="streakCount">0 días consecutivos</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECCIÓN 10: PLAN DIARIO -->
        <section id="plan-diario">
            <div class="section-title">
                <h2><i class="fas fa-calendar-day"></i> Plan Diario por Bloques de Tiempo</h2>
                <button class="btn btn-primary" id="addTimeBlockBtn">
                    <i class="fas fa-plus"></i> Agregar Bloque
                </button>
            </div>
            
            <div class="time-blocks-container">
                <div id="timeBlocksList">
                    <!-- Bloques de tiempo se generarán dinámicamente -->
                </div>
                
                <div class="productivity-meter">
                    <div class="productivity-header">
                        <h3>Productividad del Día</h3>
                        <span id="productivityPercentage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="productivityBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- MODAL DE CONFIRMACIÓN -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <h3>Confirmar Acción</h3>
            <p id="modalMessage">¿Estás seguro de realizar esta acción?</p>
            <div class="modal-buttons">
                <button class="btn btn-outline" id="modalCancelBtn">Cancelar</button>
                <button class="btn btn-danger" id="modalConfirmBtn">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- NOTIFICACIÓN -->
    <div class="notification" id="notification" style="display: none;"></div>

    <script>
        // ============================================
        // VARIABLES GLOBALES Y ESTADO DE LA APLICACIÓN
        // ============================================
        
        // Referencias a elementos DOM importantes
        const summaryGrid = document.querySelector('.summary-grid');
        const monthlyResultsTable = document.querySelector('#monthlyResultsTable tbody');
        const categoryExpensesTable = document.querySelector('#categoryExpensesTable tbody');
        const transactionsTable = document.querySelector('#transactionsTable tbody');
        const transactionForm = document.getElementById('transactionForm');
        const alertsContainer = document.getElementById('alertsContainer');
        const badHabitsList = document.getElementById('badHabitsList');
        const goodHabitsList = document.getElementById('goodHabitsList');
        const timeBlocksList = document.getElementById('timeBlocksList');
        const currentDateEl = document.getElementById('currentDate');
        
        // NUEVAS referencias para gráficos
        const lineChartCtx = document.getElementById('lineChart');
        const pieChartCtx = document.getElementById('pieChart');
        const candlestickChartCtx = document.getElementById('candlestickChart');
        let lineChart, pieChart, candlestickChart;
        
        // NUEVAS referencias para Centro de Conocimiento
        const bookList = document.getElementById('bookList');
        const conceptList = document.getElementById('conceptList');
        
        // NUEVAS referencias para Sugerencias Inteligentes
        const suggestionsContainer = document.getElementById('suggestionsContainer');
        const refreshSuggestionsBtn = document.getElementById('refreshSuggestionsBtn');
        
        // Botones de acción
        const exportBtn = document.getElementById('exportBtn');
        const clearMonthBtn = document.getElementById('clearMonthBtn');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const addMonthBtn = document.getElementById('addMonthBtn');
        const addBadHabitBtn = document.getElementById('addBadHabitBtn');
        const newBadHabitInput = document.getElementById('newBadHabit');
        const showSuggestionsBtn = document.getElementById('showSuggestionsBtn');
        const addTimeBlockBtn = document.getElementById('addTimeBlockBtn');
        const refreshChartsBtn = document.getElementById('refreshChartsBtn');
        
        // Elementos del modal
        const confirmationModal = document.getElementById('confirmationModal');
        const modalConfirmBtn = document.getElementById('modalConfirmBtn');
        const modalCancelBtn = document.getElementById('modalCancelBtn');
        const modalMessage = document.getElementById('modalMessage');
        const notification = document.getElementById('notification');
        
        // Estado de la aplicación
        let appData = {
            transactions: [],
            monthlyResults: [],
            habits: {
                bad: [],
                good: [],
                streak: 0,
                lastCompletedDate: null
            },
            timeBlocks: [],
            lastId: {
                transaction: 0,
                monthlyResult: 0,
                habit: 0,
                timeBlock: 0
            }
        };
        
        // Categorías de gastos
        const expenseCategories = [
            'alimentacion', 'transporte', 'servicios', 'educacion', 
            'entretenimiento', 'gastos-hormiga', 'otros-gastos'
        ];
        
        // Nombres legibles de categorías
        const categoryNames = {
            'salario': 'Salario',
            'freelance': 'Freelance',
            'inversiones': 'Inversiones',
            'otros-ingresos': 'Otros ingresos',
            'alimentacion': 'Alimentación',
            'transporte': 'Transporte',
            'servicios': 'Servicios',
            'educacion': 'Educación',
            'entretenimiento': 'Entretenimiento',
            'gastos-hormiga': 'Gastos hormiga',
            'otros-gastos': 'Otros gastos'
        };
        
        // Malos hábitos predeterminados
        const defaultBadHabits = [
            { id: 1, text: "Compras impulsivas", completed: false },
            { id: 2, text: "Gastar en antojos diarios", completed: false },
            { id: 3, text: "Uso excesivo de redes sociales", completed: false },
            { id: 4, text: "Consumo de contenido para adultos", completed: false },
            { id: 5, text: "Dormir tarde", completed: false },
            { id: 6, text: "Procrastinar tareas importantes", completed: false },
            { id: 7, text: "Comer comida chatarra regularmente", completed: false }
        ];
        
        // Buenos hábitos sugeridos
        const suggestedGoodHabits = [
            "Ejercicio diario (30 minutos)",
            "Lectura educativa (20 minutos al día)",
            "Estudio de habilidades nuevas",
            "Meditación o mindfulness",
            "Rutina de sueño consistente",
            "Ahorro automático (10% de ingresos)",
            "Planificación semanal de gastos",
            "Cocinar en casa más seguido",
            "Limitar tiempo en redes sociales",
            "Invertir en educación financiera"
        ];
        
        // ============================================
        // NUEVOS DATOS PARA CENTRO DE CONOCIMIENTO
        // ============================================
        
        const recommendedBooks = [
            {
                title: "Padre Rico, Padre Pobre",
                author: "Robert Kiyosaki",
                description: "Enseña la importancia de la educación financiera, la diferencia entre activos y pasivos, y cómo hacer que el dinero trabaje para ti."
            },
            {
                title: "Los Secretos de la Mente Millonaria",
                author: "T. Harv Eker",
                description: "Revela cómo los patrones de pensamiento determinan nuestro éxito financiero y cómo reprogramar la mente para la abundancia."
            },
            {
                title: "El Hombre Más Rico de Babilonia",
                author: "George S. Clason",
                description: "Parábolas financieras que enseñan las leyes fundamentales del ahorro, inversión y creación de riqueza."
            },
            {
                title: "Piense y Hágase Rico",
                author: "Napoleon Hill",
                description: "Clásico sobre la mentalidad positiva y los principios para alcanzar el éxito financiero y personal."
            },
            {
                title: "El Inversor Inteligente",
                author: "Benjamin Graham",
                description: "Guía fundamental sobre inversión en valores, análisis de empresas y estrategias de inversión a largo plazo."
            },
            {
                title: "Contabilidad Financiera para No Financieros",
                author: "Oriol Amat",
                description: "Introducción clara y práctica a los conceptos contables esenciales para emprendedores y pequeños empresarios."
            }
        ];
        
        const importantConcepts = [
            {
                title: "Estado de Resultados",
                description: "Muestra los ingresos, gastos y utilidad de un negocio en un período determinado. Esencial para medir rentabilidad."
            },
            {
                title: "Flujo de Caja",
                description: "Registro del dinero que entra y sale de tu negocio o finanzas personales. Determina la liquidez disponible."
            },
            {
                title: "Activos y Pasivos",
                description: "Activos son bienes que generan ingresos, pasivos son deudas y obligaciones. La riqueza se crea aumentando activos."
            },
            {
                title: "Punto de Equilibrio",
                description: "Momento en que los ingresos igualan a los costos. Indica cuánto necesitas vender para no perder dinero."
            },
            {
                title: "Capital de Trabajo",
                description: "Diferencia entre activos corrientes y pasivos corrientes. Mide la capacidad para cubrir obligaciones a corto plazo."
            },
            {
                title: "Margen de Ganancia",
                description: "Porcentaje de utilidad sobre las ventas. Indica qué tan rentable es cada producto o servicio que vendes."
            }
        ];
        
        // ============================================
        // FUNCIONES DE INICIALIZACIÓN
        // ============================================
        
        // Cargar datos desde localStorage al iniciar
        function loadAppData() {
            const savedData = localStorage.getItem('financialDashboardData');
            if (savedData) {
                try {
                    appData = JSON.parse(savedData);
                    console.log('Datos cargados desde localStorage');
                } catch (e) {
                    console.error('Error al cargar datos:', e);
                    initializeDefaultData();
                }
            } else {
                initializeDefaultData();
            }
            
            // Verificar si es un nuevo día para actualizar racha
            checkAndUpdateStreak();
            
            // Renderizar todos los componentes
            renderAll();
            
            // Renderizar nuevos componentes
            renderRecommendedBooks();
            renderImportantConcepts();
            generateSmartSuggestions();
            
            // Actualizar fecha actual
            updateCurrentDate();
            
            // Inicializar gráficos
            initCharts();
            
            // Inicializar animaciones de scroll
            initScrollAnimations();
        }
        
        // Inicializar datos por defecto
        function initializeDefaultData() {
            appData = {
                transactions: [],
                monthlyResults: [],
                habits: {
                    bad: defaultBadHabits,
                    good: [],
                    streak: 0,
                    lastCompletedDate: null
                },
                timeBlocks: [
                    { id: 1, startTime: "06:00", endTime: "06:30", activity: "Ejercicio", completed: false },
                    { id: 2, startTime: "06:30", endTime: "07:00", activity: "Meditación/Planificación", completed: false },
                    { id: 3, startTime: "07:00", endTime: "08:00", activity: "Desayuno y preparación", completed: false },
                    { id: 4, startTime: "08:00", endTime: "12:00", activity: "Trabajo/Estudio", completed: false },
                    { id: 5, startTime: "12:00", endTime: "13:00", activity: "Almuerzo", completed: false },
                    { id: 6, startTime: "13:00", endTime: "17:00", activity: "Trabajo/Estudio", completed: false },
                    { id: 7, startTime: "17:00", endTime: "18:00", activity: "Ejercicio/Descanso", completed: false },
                    { id: 8, startTime: "19:00", endTime: "20:00", activity: "Cena y tiempo familiar", completed: false },
                    { id: 9, startTime: "20:00", endTime: "21:00", activity: "Lectura/Estudio", completed: false },
                    { id: 10, startTime: "21:00", endTime: "22:00", activity: "Relajación/preparación para dormir", completed: false }
                ],
                lastId: {
                    transaction: 0,
                    monthlyResult: 0,
                    habit: defaultBadHabits.length,
                    timeBlock: 10
                }
            };
        }
        
        // Guardar datos en localStorage
        function saveAppData() {
            localStorage.setItem('financialDashboardData', JSON.stringify(appData));
        }
        
        // Actualizar fecha actual en la UI
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            currentDateEl.textContent = now.toLocaleDateString('es-ES', options);
        }
        
        // Verificar y actualizar racha de hábitos
        function checkAndUpdateStreak() {
            const today = new Date().toDateString();
            const lastDate = appData.habits.lastCompletedDate;
            
            if (!lastDate) return;
            
            const lastDateObj = new Date(lastDate);
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (lastDateObj.toDateString() === yesterday.toDateString()) {
                appData.habits.streak++;
                saveAppData();
            } 
            else if (lastDateObj.toDateString() !== today && lastDateObj.toDateString() !== yesterday.toDateString()) {
                appData.habits.streak = 0;
                saveAppData();
            }
        }
        
        // Renderizar todos los componentes
        function renderAll() {
            renderSummaryCards();
            renderMonthlyResults();
            renderCategoryExpenses();
            renderTransactions();
            renderAlerts();
            renderHabits();
            renderTimeBlocks();
        }
        
        // ============================================
        // FUNCIONES ORIGINALES DEL DASHBOARD
        // ============================================
        
        // Renderizar tarjetas de resumen financiero
        function renderSummaryCards() {
            summaryGrid.innerHTML = '';
            
            const today = new Date().toISOString().split('T')[0];
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const dayIncome = calculateTotalByPeriod('income', 'day', today);
            const dayExpense = calculateTotalByPeriod('expense', 'day', today);
            const dayBalance = dayIncome - dayExpense;
            
            const monthIncome = calculateTotalByPeriod('income', 'month', currentMonth, currentYear);
            const monthExpense = calculateTotalByPeriod('expense', 'month', currentMonth, currentYear);
            const monthBalance = monthIncome - monthExpense;
            
            const yearIncome = calculateTotalByPeriod('income', 'year', null, currentYear);
            const yearExpense = calculateTotalByPeriod('expense', 'year', null, currentYear);
            const yearBalance = yearIncome - yearExpense;
            
            const summaryCards = [
                {
                    title: "Ingresos del día",
                    amount: dayIncome,
                    period: "Hoy",
                    icon: "fas fa-arrow-down",
                    type: "income"
                },
                {
                    title: "Gastos del día",
                    amount: dayExpense,
                    period: "Hoy",
                    icon: "fas fa-arrow-up",
                    type: "expense"
                },
                {
                    title: "Balance del día",
                    amount: dayBalance,
                    period: "Hoy",
                    icon: "fas fa-balance-scale",
                    type: "balance",
                    positive: dayBalance >= 0
                },
                {
                    title: "Ingresos del mes",
                    amount: monthIncome,
                    period: "Mes actual",
                    icon: "fas fa-calendar",
                    type: "income"
                },
                {
                    title: "Gastos del mes",
                    amount: monthExpense,
                    period: "Mes actual",
                    icon: "fas fa-calendar",
                    type: "expense"
                },
                {
                    title: "Balance del mes",
                    amount: monthBalance,
                    period: "Mes actual",
                    icon: "fas fa-chart-line",
                    type: "balance",
                    positive: monthBalance >= 0
                },
                {
                    title: "Ingresos del año",
                    amount: yearIncome,
                    period: "Año actual",
                    icon: "fas fa-calendar-alt",
                    type: "income"
                },
                {
                    title: "Gastos del año",
                    amount: yearExpense,
                    period: "Año actual",
                    icon: "fas fa-calendar-alt",
                    type: "expense"
                },
                {
                    title: "Balance del año",
                    amount: yearBalance,
                    period: "Año actual",
                    icon: "fas fa-chart-bar",
                    type: "balance",
                    positive: yearBalance >= 0
                }
            ];
            
            summaryCards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = `summary-card ${card.type === 'balance' ? (card.positive ? 'positive' : 'negative') : ''}`;
                
                const amountClass = card.type === 'balance' ? 
                    (card.positive ? 'positive-number' : 'negative-number') : 
                    (card.type === 'income' ? 'positive-number' : 'negative-number');
                
                cardElement.innerHTML = `
                    <div class="summary-card-header">
                        <h3>${card.title}</h3>
                        <i class="${card.icon}"></i>
                    </div>
                    <div class="summary-amount ${amountClass}">$${card.amount.toFixed(2)}</div>
                    <div class="summary-period">${card.period}</div>
                `;
                
                summaryGrid.appendChild(cardElement);
            });
        }
        
        // Calcular totales por período
        function calculateTotalByPeriod(type, period, specificPeriod, year = null) {
            return appData.transactions
                .filter(transaction => {
                    const transactionDate = new Date(transaction.date);
                    
                    if (transaction.type !== type) return false;
                    
                    if (period === 'day') {
                        return transaction.date === specificPeriod;
                    } else if (period === 'month') {
                        return transactionDate.getMonth() === specificPeriod && 
                               transactionDate.getFullYear() === year;
                    } else if (period === 'year') {
                        return transactionDate.getFullYear() === year;
                    }
                    
                    return true;
                })
                .reduce((total, transaction) => total + transaction.amount, 0);
        }
        
        // Renderizar tabla de estado de resultados mensual
        function renderMonthlyResults() {
            monthlyResultsTable.innerHTML = '';
            
            if (appData.monthlyResults.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" style="text-align: center; padding: 30px; color: var(--secondary-color);">
                        No hay datos mensuales registrados. Agrega movimientos y se calcularán automáticamente.
                    </td>
                `;
                monthlyResultsTable.appendChild(row);
                return;
            }
            
            const sortedResults = [...appData.monthlyResults].sort((a, b) => {
                const dateA = new Date(a.year, a.month);
                const dateB = new Date(b.year, b.month);
                return dateB - dateA;
            });
            
            sortedResults.forEach(result => {
                const row = document.createElement('tr');
                const resultAmount = result.income - result.expense;
                const resultClass = resultAmount >= 0 ? 'positive-number' : 'negative-number';
                const resultText = resultAmount >= 0 ? 'Ahorro' : 'Déficit';
                
                row.innerHTML = `
                    <td>${getMonthName(result.month)} ${result.year}</td>
                    <td class="positive-number">$${result.income.toFixed(2)}</td>
                    <td class="negative-number">$${result.expense.toFixed(2)}</td>
                    <td class="${resultClass}">$${Math.abs(resultAmount).toFixed(2)} (${resultText})</td>
                `;
                
                monthlyResultsTable.appendChild(row);
            });
        }
        
        // Actualizar resultados mensuales automáticamente
        function updateMonthlyResults() {
            const monthlyData = {};
            
            appData.transactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const month = date.getMonth();
                const year = date.getFullYear();
                const key = `${year}-${month}`;
                
                if (!monthlyData[key]) {
                    monthlyData[key] = {
                        month: month,
                        year: year,
                        income: 0,
                        expense: 0
                    };
                }
                
                if (transaction.type === 'income') {
                    monthlyData[key].income += transaction.amount;
                } else {
                    monthlyData[key].expense += transaction.amount;
                }
            });
            
            appData.monthlyResults = Object.values(monthlyData);
            saveAppData();
            
            renderMonthlyResults();
        }
        
        // Obtener nombre del mes
        function getMonthName(monthIndex) {
            const months = [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
            ];
            return months[monthIndex];
        }
        
        // Renderizar tabla de gastos por categoría
        function renderCategoryExpenses() {
            categoryExpensesTable.innerHTML = '';
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthlyExpenses = appData.transactions.filter(transaction => {
                if (transaction.type !== 'expense') return false;
                
                const date = new Date(transaction.date);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });
            
            if (monthlyExpenses.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" style="text-align: center; padding: 30px; color: var(--secondary-color);">
                        No hay gastos registrados este mes.
                    </td>
                `;
                categoryExpensesTable.appendChild(row);
                return;
            }
            
            const totalMonthlyExpense = monthlyExpenses.reduce((total, expense) => total + expense.amount, 0);
            
            const categoryTotals = {};
            monthlyExpenses.forEach(expense => {
                if (!categoryTotals[expense.category]) {
                    categoryTotals[expense.category] = 0;
                }
                categoryTotals[expense.category] += expense.amount;
            });
            
            expenseCategories.forEach(category => {
                if (categoryTotals[category] || category === 'gastos-hormiga') {
                    const amount = categoryTotals[category] || 0;
                    const percentage = totalMonthlyExpense > 0 ? (amount / totalMonthlyExpense) * 100 : 0;
                    
                    let status = '';
                    let statusClass = '';
                    
                    if (category === 'gastos-hormiga' && percentage > 15) {
                        status = 'ALTA (>15%)';
                        statusClass = 'badge badge-warning';
                    } else if (percentage === 0) {
                        status = 'Sin gastos';
                        statusClass = '';
                    } else if (percentage > 30) {
                        status = 'Alto';
                        statusClass = 'badge badge-warning';
                    } else {
                        status = 'Normal';
                        statusClass = '';
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${categoryNames[category] || category}</strong></td>
                        <td class="negative-number">$${amount.toFixed(2)}</td>
                        <td>${percentage.toFixed(1)}%</td>
                        <td><span class="${statusClass}">${status}</span></td>
                    `;
                    
                    categoryExpensesTable.appendChild(row);
                }
            });
            
            const totalRow = document.createElement('tr');
            totalRow.style.backgroundColor = 'var(--gray-light)';
            totalRow.innerHTML = `
                <td><strong>TOTAL</strong></td>
                <td class="negative-number"><strong>$${totalMonthlyExpense.toFixed(2)}</strong></td>
                <td><strong>100%</strong></td>
                <td></td>
            `;
            categoryExpensesTable.appendChild(totalRow);
        }
        
        // Renderizar tabla de transacciones
        function renderTransactions() {
            transactionsTable.innerHTML = '';
            
            if (appData.transactions.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" style="text-align: center; padding: 30px; color: var(--secondary-color);">
                        No hay movimientos registrados. Comienza agregando tu primer ingreso o gasto.
                    </td>
                `;
                transactionsTable.appendChild(row);
                return;
            }
            
            const sortedTransactions = [...appData.transactions].sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });
            
            sortedTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                const amountClass = transaction.type === 'income' ? 'positive-number' : 'negative-number';
                const badgeClass = transaction.type === 'income' ? 'badge-income' : 'badge-expense';
                const typeText = transaction.type === 'income' ? 'Ingreso' : 'Gasto';
                
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td><span class="badge ${badgeClass}">${typeText}</span></td>
                    <td>${categoryNames[transaction.category] || transaction.category}</td>
                    <td>${transaction.description || '-'}</td>
                    <td class="${amountClass}">${transaction.type === 'income' ? '+' : '-'}$${transaction.amount.toFixed(2)}</td>
                    <td>
                        <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                transactionsTable.appendChild(row);
            });
        }
        
        // Formatear fecha para mostrar
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }
        
        // Agregar nueva transacción
        function addTransaction(type, amount, category, description, date) {
            appData.lastId.transaction++;
            const newTransaction = {
                id: appData.lastId.transaction,
                type: type,
                amount: parseFloat(amount),
                category: category,
                description: description.trim(),
                date: date
            };
            
            appData.transactions.push(newTransaction);
            saveAppData();
            updateMonthlyResults();
            renderAll();
            showNotification('Movimiento registrado correctamente', 'success');
        }
        
        // Eliminar transacción
        function deleteTransaction(id) {
            appData.transactions = appData.transactions.filter(t => t.id !== id);
            saveAppData();
            updateMonthlyResults();
            renderAll();
            showNotification('Movimiento eliminado', 'error');
        }
        
        // Renderizar alertas
        function renderAlerts() {
            alertsContainer.innerHTML = '';
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthIncome = calculateTotalByPeriod('income', 'month', currentMonth, currentYear);
            const monthExpense = calculateTotalByPeriod('expense', 'month', currentMonth, currentYear);
            const monthBalance = monthIncome - monthExpense;
            
            const monthlyExpenses = appData.transactions.filter(transaction => {
                if (transaction.type !== 'expense') return false;
                const date = new Date(transaction.date);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });
            
            const totalMonthlyExpense = monthlyExpenses.reduce((total, expense) => total + expense.amount, 0);
            const antExpenses = monthlyExpenses.filter(e => e.category === 'gastos-hormiga')
                                              .reduce((total, expense) => total + expense.amount, 0);
            const antPercentage = totalMonthlyExpense > 0 ? (antExpenses / totalMonthlyExpense) * 100 : 0;
            
            const categoryTotals = {};
            monthlyExpenses.forEach(expense => {
                if (!categoryTotals[expense.category]) {
                    categoryTotals[expense.category] = 0;
                }
                categoryTotals[expense.category] += expense.amount;
            });
            
            let topCategory = '';
            let topCategoryAmount = 0;
            
            for (const category in categoryTotals) {
                if (categoryTotals[category] > topCategoryAmount) {
                    topCategoryAmount = categoryTotals[category];
                    topCategory = category;
                }
            }
            
            const topCategoryPercentage = totalMonthlyExpense > 0 ? (topCategoryAmount / totalMonthlyExpense) * 100 : 0;
            
            const alerts = [];
            
            if (monthBalance > 0) {
                alerts.push({
                    type: 'success',
                    icon: 'fas fa-piggy-bank',
                    title: '¡Estás ahorrando este mes!',
                    message: `Tienes un balance positivo de $${monthBalance.toFixed(2)}. ¡Buen trabajo!`
                });
            } else if (monthBalance < 0) {
                alerts.push({
                    type: 'danger',
                    icon: 'fas fa-exclamation-triangle',
                    title: 'Déficit este mes',
                    message: `Tu balance es negativo en $${Math.abs(monthBalance).toFixed(2)}. Considera reducir gastos.`
                });
            }
            
            if (antPercentage > 15) {
                alerts.push({
                    type: 'danger',
                    icon: 'fas fa-bug',
                    title: 'Gastos hormiga elevados',
                    message: `Tus gastos hormiga representan el ${antPercentage.toFixed(1)}% de tus gastos totales (recomendado <15%).`
                });
            } else if (antPercentage > 0 && antPercentage <= 15) {
                alerts.push({
                    type: 'success',
                    icon: 'fas fa-check-circle',
                    title: 'Gastos hormiga controlados',
                    message: `Tus gastos hormiga están en ${antPercentage.toFixed(1)}%, dentro del rango recomendado.`
                });
            }
            
            if (topCategoryPercentage > 40 && topCategory !== '') {
                alerts.push({
                    type: 'warning',
                    icon: 'fas fa-chart-pie',
                    title: 'Gasto concentrado en una categoría',
                    message: `El ${topCategoryPercentage.toFixed(1)}% de tus gastos son en ${categoryNames[topCategory]}. Considera diversificar.`
                });
            }
            
            if (monthIncome > 0 && monthExpense/monthIncome < 0.7) {
                alerts.push({
                    type: 'success',
                    icon: 'fas fa-trophy',
                    title: 'Excelente control financiero',
                    message: 'Estás gastando menos del 70% de tus ingresos. ¡Sigue así!'
                });
            }
            
            if (monthIncome === 0 && appData.transactions.length > 0) {
                alerts.push({
                    type: 'warning',
                    icon: 'fas fa-money-bill-wave',
                    title: 'Sin ingresos registrados este mes',
                    message: 'Recuerda registrar tus ingresos para tener un balance completo.'
                });
            }
            
            if (alerts.length === 0) {
                alerts.push({
                    type: 'info',
                    icon: 'fas fa-info-circle',
                    title: 'Sin alertas críticas',
                    message: 'Tu situación financiera parece estable. Continúa monitoreando tus gastos.'
                });
            }
            
            alerts.forEach(alert => {
                const alertElement = document.createElement('div');
                alertElement.className = `alert-card ${alert.type}`;
                alertElement.innerHTML = `
                    <div class="alert-icon">
                        <i class="${alert.icon}"></i>
                    </div>
                    <div class="alert-content">
                        <h4>${alert.title}</h4>
                        <p>${alert.message}</p>
                    </div>
                `;
                
                alertsContainer.appendChild(alertElement);
            });
        }
        
        // Renderizar hábitos
        function renderHabits() {
            renderBadHabits();
            renderGoodHabits();
            document.getElementById('streakCount').textContent = `${appData.habits.streak} días consecutivos`;
        }
        
        // Renderizar malos hábitos
        function renderBadHabits() {
            badHabitsList.innerHTML = '';
            
            if (appData.habits.bad.length === 0) {
                badHabitsList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--gray);">
                        No hay malos hábitos registrados.
                    </div>
                `;
                return;
            }
            
            appData.habits.bad.forEach(habit => {
                const habitElement = document.createElement('div');
                habitElement.className = `habit-item ${habit.completed ? 'completed' : ''}`;
                habitElement.innerHTML = `
                    <input type="checkbox" class="habit-checkbox" ${habit.completed ? 'checked' : ''} 
                           onclick="toggleHabitCompletion('bad', ${habit.id})">
                    <div class="habit-text">${habit.text}</div>
                    <button class="delete-btn btn-sm" onclick="deleteHabit('bad', ${habit.id})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                badHabitsList.appendChild(habitElement);
            });
        }
        
        // Renderizar buenos hábitos
        function renderGoodHabits() {
            goodHabitsList.innerHTML = '';
            
            if (appData.habits.good.length === 0) {
                goodHabitsList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--gray);">
                        Selecciona un mal hábito para ver buenas alternativas.
                    </div>
                `;
                return;
            }
            
            appData.habits.good.forEach(habit => {
                const habitElement = document.createElement('div');
                habitElement.className = `habit-item ${habit.completed ? 'completed' : ''}`;
                habitElement.innerHTML = `
                    <input type="checkbox" class="habit-checkbox" ${habit.completed ? 'checked' : ''} 
                           onclick="toggleHabitCompletion('good', ${habit.id})">
                    <div class="habit-text">${habit.text}</div>
                `;
                
                goodHabitsList.appendChild(habitElement);
            });
        }
        
        // Agregar mal hábito
        function addBadHabit(text) {
            if (!text.trim()) {
                showNotification('Ingresa un texto para el hábito', 'error');
                return;
            }
            
            appData.lastId.habit++;
            const newHabit = {
                id: appData.lastId.habit,
                text: text.trim(),
                completed: false
            };
            
            appData.habits.bad.push(newHabit);
            saveAppData();
            renderHabits();
            showNotification('Mal hábito agregado', 'success');
            
            newBadHabitInput.value = '';
        }
        
        // Eliminar hábito
        function deleteHabit(type, id) {
            if (type === 'bad') {
                appData.habits.bad = appData.habits.bad.filter(h => h.id !== id);
            } else {
                appData.habits.good = appData.habits.good.filter(h => h.id !== id);
            }
            
            saveAppData();
            renderHabits();
            showNotification('Hábito eliminado', 'error');
        }
        
        // Alternar estado de completitud de hábito
        function toggleHabitCompletion(type, id) {
            let habit;
            
            if (type === 'bad') {
                habit = appData.habits.bad.find(h => h.id === id);
            } else {
                habit = appData.habits.good.find(h => h.id === id);
            }
            
            if (habit) {
                habit.completed = !habit.completed;
                
                if (type === 'good' && habit.completed) {
                    const today = new Date().toDateString();
                    
                    if (appData.habits.lastCompletedDate !== today) {
                        appData.habits.lastCompletedDate = today;
                        
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        
                        if (appData.habits.lastCompletedDate === yesterday.toDateString()) {
                            appData.habits.streak++;
                        } else {
                            appData.habits.streak = 1;
                        }
                    }
                }
                
                saveAppData();
                renderHabits();
            }
        }
        
        // Mostrar sugerencias de buenos hábitos
        function showGoodHabitSuggestions() {
            const selectedBadHabits = appData.habits.bad.filter(h => h.completed);
            
            if (selectedBadHabits.length === 0) {
                appData.habits.good = suggestedGoodHabits.map((text, index) => ({
                    id: index + 1,
                    text: text,
                    completed: false
                }));
            } else {
                appData.habits.good = selectedBadHabits.map((habit, index) => {
                    const suggestionIndex = index % suggestedGoodHabits.length;
                    return {
                        id: index + 1,
                        text: suggestedGoodHabits[suggestionIndex],
                        completed: false
                    };
                });
            }
            
            saveAppData();
            renderHabits();
            showNotification('Sugerencias de buenos hábitos cargadas', 'success');
        }
        
        // Renderizar bloques de tiempo
        function renderTimeBlocks() {
            timeBlocksList.innerHTML = '';
            
            if (appData.timeBlocks.length === 0) {
                timeBlocksList.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--gray);">
                        No hay bloques de tiempo programados.
                    </div>
                `;
                return;
            }
            
            const sortedBlocks = [...appData.timeBlocks].sort((a, b) => {
                return a.startTime.localeCompare(b.startTime);
            });
            
            sortedBlocks.forEach(block => {
                const blockElement = document.createElement('div');
                blockElement.className = 'time-block';
                blockElement.innerHTML = `
                    <div class="time-range">
                        <input type="time" value="${block.startTime}" 
                               onchange="updateTimeBlock(${block.id}, 'startTime', this.value)" style="width: 80px;">
                        -
                        <input type="time" value="${block.endTime}" 
                               onchange="updateTimeBlock(${block.id}, 'endTime', this.value)" style="width: 80px;">
                    </div>
                    <div class="time-activity">
                        <input type="text" value="${block.activity}" 
                               onchange="updateTimeBlock(${block.id}, 'activity', this.value)">
                    </div>
                    <input type="checkbox" class="habit-checkbox" ${block.completed ? 'checked' : ''}
                           onclick="toggleTimeBlockCompletion(${block.id})">
                    <button class="delete-btn" onclick="deleteTimeBlock(${block.id})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                timeBlocksList.appendChild(blockElement);
            });
            
            calculateProductivity();
        }
        
        // Calcular productividad del día
        function calculateProductivity() {
            const completedBlocks = appData.timeBlocks.filter(block => block.completed).length;
            const totalBlocks = appData.timeBlocks.length;
            const percentage = totalBlocks > 0 ? (completedBlocks / totalBlocks) * 100 : 0;
            
            document.getElementById('productivityPercentage').textContent = `${percentage.toFixed(0)}%`;
            document.getElementById('productivityBar').style.width = `${percentage}%`;
        }
        
        // Agregar bloque de tiempo
        function addTimeBlock() {
            appData.lastId.timeBlock++;
            const newBlock = {
                id: appData.lastId.timeBlock,
                startTime: "00:00",
                endTime: "00:30",
                activity: "Nueva actividad",
                completed: false
            };
            
            appData.timeBlocks.push(newBlock);
            saveAppData();
            renderTimeBlocks();
            showNotification('Bloque de tiempo agregado', 'success');
        }
        
        // Actualizar bloque de tiempo
        function updateTimeBlock(id, field, value) {
            const block = appData.timeBlocks.find(b => b.id === id);
            if (block) {
                block[field] = value;
                saveAppData();
            }
        }
        
        // Alternar estado de completitud de bloque de tiempo
        function toggleTimeBlockCompletion(id) {
            const block = appData.timeBlocks.find(b => b.id === id);
            if (block) {
                block.completed = !block.completed;
                saveAppData();
                renderTimeBlocks();
            }
        }
        
        // Eliminar bloque de tiempo
        function deleteTimeBlock(id) {
            appData.timeBlocks = appData.timeBlocks.filter(b => b.id !== id);
            saveAppData();
            renderTimeBlocks();
            showNotification('Bloque de tiempo eliminado', 'error');
        }
        
        // ============================================
        // NUEVAS FUNCIONALIDADES: GRÁFICOS AVANZADOS
        // ============================================
        
        // Inicializar todos los gráficos
        function initCharts() {
            renderLineChart();
            renderPieChart();
            renderCandlestickChart();
        }
        
        // Actualizar todos los gráficos
        function updateCharts() {
            if (lineChart) lineChart.destroy();
            if (pieChart) pieChart.destroy();
            if (candlestickChart) candlestickChart.destroy();
            
            initCharts();
            showNotification('Gráficos actualizados', 'success');
        }
        
        // Gráfico de líneas: Ingresos vs Gastos por mes
        function renderLineChart() {
            const monthlyData = getMonthlyDataForChart();
            
            if (monthlyData.length === 0) {
                lineChartCtx.parentElement.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--secondary-color);">
                        <div style="text-align: center;">
                            <i class="fas fa-chart-line" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>No hay datos suficientes para mostrar el gráfico</p>
                            <p style="font-size: 0.9rem;">Agrega ingresos y gastos para ver la evolución</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            const labels = monthlyData.map(item => `${getShortMonthName(item.month)} ${item.year}`);
            const incomeData = monthlyData.map(item => item.income);
            const expenseData = monthlyData.map(item => item.expense);
            const balanceData = monthlyData.map(item => item.income - item.expense);
            
            lineChart = new Chart(lineChartCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Ingresos',
                            data: incomeData,
                            borderColor: 'rgba(0, 200, 83, 1)',
                            backgroundColor: 'rgba(0, 200, 83, 0.1)',
                            borderWidth: 4,
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: 'rgba(0, 200, 83, 1)',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 10
                        },
                        {
                            label: 'Gastos',
                            data: expenseData,
                            borderColor: 'rgba(255, 61, 0, 1)',
                            backgroundColor: 'rgba(255, 61, 0, 0.1)',
                            borderWidth: 4,
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: 'rgba(255, 61, 0, 1)',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 10
                        },
                        {
                            label: 'Balance',
                            data: balanceData,
                            borderColor: 'rgba(0, 102, 255, 1)',
                            backgroundColor: 'rgba(0, 102, 255, 0.1)',
                            borderWidth: 3,
                            borderDash: [5, 5],
                            tension: 0.4,
                            fill: false,
                            pointBackgroundColor: 'rgba(0, 102, 255, 1)',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5,
                            pointHoverRadius: 9
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#1a1a1a',
                                font: {
                                    size: 13,
                                    weight: '600'
                                },
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 102, 255, 0.1)'
                            },
                            ticks: {
                                color: '#667085',
                                font: {
                                    size: 12,
                                    weight: '500'
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 102, 255, 0.1)'
                            },
                            ticks: {
                                color: '#667085',
                                font: {
                                    size: 12,
                                    weight: '500'
                                },
                                callback: function(value) {
                                    return '$' + value.toLocaleString('es-ES');
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Gráfico circular: Distribución de gastos
        function renderPieChart() {
            const categoryData = getCategoryDataForChart();
            
            if (categoryData.length === 0) {
                pieChartCtx.parentElement.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--secondary-color);">
                        <div style="text-align: center;">
                            <i class="fas fa-chart-pie" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>No hay gastos registrados este mes</p>
                            <p style="font-size: 0.9rem;">Agrega gastos para ver la distribución por categoría</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            const labels = categoryData.map(item => item.category);
            const data = categoryData.map(item => item.amount);
            const total = data.reduce((sum, value) => sum + value, 0);
            
            const backgroundColors = [
                'rgba(0, 102, 255, 0.8)',
                'rgba(0, 200, 83, 0.8)',
                'rgba(255, 171, 0, 0.8)',
                'rgba(255, 61, 0, 0.8)',
                'rgba(155, 81, 224, 0.8)',
                'rgba(0, 184, 212, 0.8)',
                'rgba(244, 67, 54, 0.8)',
                'rgba(76, 175, 80, 0.8)',
                'rgba(255, 152, 0, 0.8)',
                'rgba(33, 150, 243, 0.8)'
            ];
            
            pieChart = new Chart(pieChartCtx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: 'rgba(255, 255, 255, 0.9)',
                        borderWidth: 2,
                        hoverOffset: 25,
                        hoverBorderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#1a1a1a',
                                padding: 25,
                                font: {
                                    size: 12,
                                    weight: '500'
                                }
                            }
                        }
                    },
                    cutout: '65%',
                    radius: '90%'
                }
            });
        }
        
        // Gráfico tipo velas: Balance diario
        function renderCandlestickChart() {
            const candlestickData = getCandlestickData();
            
            if (candlestickData.length === 0) {
                candlestickChartCtx.parentElement.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--secondary-color);">
                        <div style="text-align: center;">
                            <i class="fas fa-chart-candlestick" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>No hay datos suficientes para el gráfico de velas</p>
                            <p style="font-size: 0.9rem;">Agrega movimientos diarios para ver la variación</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            const labels = candlestickData.map(item => item.date);
            const data = candlestickData.map(item => ({
                x: item.date,
                o: item.open,
                h: item.high,
                l: item.low,
                c: item.close,
                color: item.close >= item.open ? 'rgba(0, 200, 83, 0.8)' : 'rgba(255, 61, 0, 0.8)',
                borderColor: item.close >= item.open ? 'rgba(0, 200, 83, 1)' : 'rgba(255, 61, 0, 1)'
            }));
            
            candlestickChart = new Chart(candlestickChartCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Balance Diario',
                        data: data,
                        backgroundColor: data.map(d => d.color),
                        borderColor: data.map(d => d.borderColor),
                        borderWidth: 1,
                        borderSkipped: false,
                        borderRadius: 5,
                        barPercentage: 0.6,
                        categoryPercentage: 0.8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(0, 102, 255, 0.1)'
                            },
                            ticks: {
                                color: '#667085',
                                font: {
                                    size: 11,
                                    weight: '500'
                                },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(0, 102, 255, 0.1)'
                            },
                            ticks: {
                                color: '#667085',
                                font: {
                                    size: 12,
                                    weight: '500'
                                },
                                callback: function(value) {
                                    return '$' + value.toLocaleString('es-ES');
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ============================================
        // NUEVAS FUNCIONALIDADES: CENTRO DE CONOCIMIENTO
        // ============================================
        
        // Renderizar libros recomendados
        function renderRecommendedBooks() {
            bookList.innerHTML = '';
            
            recommendedBooks.forEach(book => {
                const bookElement = document.createElement('div');
                bookElement.className = 'book-item';
                bookElement.innerHTML = `
                    <div class="book-title">${book.title}</div>
                    <div class="book-author">${book.author}</div>
                    <div class="book-description">${book.description}</div>
                `;
                bookList.appendChild(bookElement);
            });
        }
        
        // Renderizar conceptos importantes
        function renderImportantConcepts() {
            conceptList.innerHTML = '';
            
            importantConcepts.forEach(concept => {
                const conceptElement = document.createElement('div');
                conceptElement.className = 'concept-item';
                conceptElement.innerHTML = `
                    <div class="concept-title">
                        <i class="fas fa-star"></i>
                        ${concept.title}
                    </div>
                    <div class="concept-description">${concept.description}</div>
                `;
                conceptList.appendChild(conceptElement);
            });
        }
        
        // ============================================
        // NUEVAS FUNCIONALIDADES: SUGERENCIAS INTELIGENTES
        // ============================================
        
        // Generar sugerencias inteligentes basadas en datos
        function generateSmartSuggestions() {
            suggestionsContainer.innerHTML = '';
            
            const suggestions = analyzeDataForSuggestions();
            
            if (suggestions.length === 0) {
                suggestionsContainer.innerHTML = `
                    <div class="suggestion-card">
                        <div class="suggestion-header">
                            <i class="fas fa-info-circle suggestion-icon"></i>
                            <h3>No hay datos suficientes</h3>
                        </div>
                        <div class="suggestion-content">
                            <p>Agrega más ingresos y gastos para recibir recomendaciones personalizadas.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            suggestions.forEach((suggestion, index) => {
                setTimeout(() => {
                    const suggestionElement = document.createElement('div');
                    suggestionElement.className = 'suggestion-card';
                    suggestionElement.style.animationDelay = `${index * 0.1}s`;
                    suggestionElement.innerHTML = `
                        <div class="suggestion-header">
                            <i class="${suggestion.icon} suggestion-icon"></i>
                            <h3>${suggestion.title}</h3>
                        </div>
                        <div class="suggestion-content">
                            <p>${suggestion.message}</p>
                            ${suggestion.action ? `<a href="#" class="suggestion-action" onclick="${suggestion.action}">${suggestion.actionText}</a>` : ''}
                        </div>
                    `;
                    suggestionsContainer.appendChild(suggestionElement);
                }, index * 100);
            });
        }
        
        // Analizar datos para generar sugerencias
        function analyzeDataForSuggestions() {
            const suggestions = [];
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthlyExpenses = appData.transactions.filter(transaction => {
                if (transaction.type !== 'expense') return false;
                const date = new Date(transaction.date);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });
            
            const monthlyIncome = appData.transactions.filter(transaction => {
                if (transaction.type !== 'income') return false;
                const date = new Date(transaction.date);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });
            
            const totalExpenses = monthlyExpenses.reduce((sum, t) => sum + t.amount, 0);
            const totalIncome = monthlyIncome.reduce((sum, t) => sum + t.amount, 0);
            const balance = totalIncome - totalExpenses;
            
            // 1. Análisis de gastos hormiga
            const antExpenses = monthlyExpenses.filter(e => e.category === 'gastos-hormiga')
                                              .reduce((sum, e) => sum + e.amount, 0);
            const antPercentage = totalExpenses > 0 ? (antExpenses / totalExpenses) * 100 : 0;
            
            if (antPercentage > 15) {
                const potentialSavings = antExpenses * 0.3;
                suggestions.push({
                    icon: 'fas fa-bug',
                    title: 'Gastos Hormiga Elevados',
                    message: `Tus gastos hormiga representan el ${antPercentage.toFixed(1)}% de tus gastos totales (${antExpenses.toLocaleString('es-ES', { style: 'currency', currency: 'USD' })}). Puedes ahorrar aproximadamente ${potentialSavings.toLocaleString('es-ES', { style: 'currency', currency: 'USD' })} mensuales reduciéndolos en un 30%.`,
                    actionText: 'Ver estrategias',
                    action: 'showAntExpenseStrategies()'
                });
            }
            
            // 2. Análisis de categoría con mayor gasto
            const categoryTotals = {};
            monthlyExpenses.forEach(expense => {
                if (!categoryTotals[expense.category]) {
                    categoryTotals[expense.category] = 0;
                }
                categoryTotals[expense.category] += expense.amount;
            });
            
            let topCategory = '';
            let topCategoryAmount = 0;
            for (const category in categoryTotals) {
                if (categoryTotals[category] > topCategoryAmount) {
                    topCategoryAmount = categoryTotals[category];
                    topCategory = category;
                }
            }
            
            const topCategoryPercentage = totalExpenses > 0 ? (topCategoryAmount / totalExpenses) * 100 : 0;
            
            if (topCategoryPercentage > 40 && topCategory !== '') {
                suggestions.push({
                    icon: 'fas fa-chart-pie',
                    title: 'Gasto Concentrado',
                    message: `El ${topCategoryPercentage.toFixed(1)}% de tus gastos están en ${categoryNames[topCategory]}. Considera diversificar o optimizar estos gastos para mejorar tu balance.`,
                    actionText: 'Ver análisis',
                    action: 'showCategoryAnalysis()'
                });
            }
            
            // 3. Análisis de balance mensual
            if (balance > 0 && totalIncome > 0) {
                const savingsRate = (balance / totalIncome) * 100;
                
                if (savingsRate >= 20) {
                    suggestions.push({
                        icon: 'fas fa-trophy',
                        title: '¡Excelente Tasa de Ahorro!',
                        message: `Estás ahorrando el ${savingsRate.toFixed(1)}% de tus ingresos este mes. Considera invertir parte de estos ahorros para hacer crecer tu patrimonio.`,
                        actionText: 'Ver opciones',
                        action: 'showInvestmentOptions()'
                    });
                } else if (savingsRate > 0) {
                    suggestions.push({
                        icon: 'fas fa-piggy-bank',
                        title: 'Balance Positivo',
                        message: `Tienes un balance positivo de ${balance.toLocaleString('es-ES', { style: 'currency', currency: 'USD' })} este mes. Sigue así y considera aumentar tu tasa de ahorro gradualmente.`,
                        actionText: 'Ver consejos',
                        action: 'showSavingsTips()'
                    });
                }
            } else if (balance < 0) {
                suggestions.push({
                    icon: 'fas fa-exclamation-triangle',
                    title: 'Balance Negativo',
                    message: `Tu balance es negativo en ${Math.abs(balance).toLocaleString('es-ES', { style: 'currency', currency: 'USD' })} este mes. Revisa tus gastos y considera ajustes en las categorías más altas.`,
                    actionText: 'Ver ajustes',
                    action: 'showExpenseAdjustments()'
                });
            }
            
            // 4. Sugerencia de educación financiera
            if (totalIncome > 0 && monthlyExpenses.length >= 5) {
                suggestions.push({
                    icon: 'fas fa-graduation-cap',
                    title: 'Invertir en Conocimiento',
                    message: 'Tienes un buen historial de seguimiento financiero. Considera invertir en educación financiera para tomar mejores decisiones de inversión.',
                    actionText: 'Ver recursos',
                    action: 'showFinancialEducation()'
                });
            }
            
            // 5. Sugerencia para comida
            if (categoryTotals['alimentacion'] && categoryTotals['alimentacion'] > totalIncome * 0.25) {
                suggestions.push({
                    icon: 'fas fa-utensils',
                    title: 'Gastos en Alimentación',
                    message: `Estás gastando ${((categoryTotals['alimentacion'] / totalIncome) * 100).toFixed(1)}% de tus ingresos en alimentación. Considera planificar comidas semanales para reducir costos.`,
                    actionText: 'Ver recetas',
                    action: 'showMealPlanning()'
                });
            }
            
            return suggestions;
        }
        
        // ============================================
        // FUNCIONES AUXILIARES PARA GRÁFICOS
        // ============================================
        
        // Obtener datos mensuales para gráfico de líneas
        function getMonthlyDataForChart() {
            const monthlyData = {};
            
            appData.transactions.forEach(transaction => {
                const date = new Date(transaction.date);
                const month = date.getMonth();
                const year = date.getFullYear();
                const key = `${year}-${month}`;
                
                if (!monthlyData[key]) {
                    monthlyData[key] = {
                        month: month,
                        year: year,
                        income: 0,
                        expense: 0
                    };
                }
                
                if (transaction.type === 'income') {
                    monthlyData[key].income += transaction.amount;
                } else {
                    monthlyData[key].expense += transaction.amount;
                }
            });
            
            return Object.values(monthlyData)
                .sort((a, b) => {
                    if (a.year !== b.year) return a.year - b.year;
                    return a.month - b.month;
                })
                .slice(-8);
        }
        
        // Obtener nombre corto del mes
        function getShortMonthName(monthIndex) {
            const months = [
                'Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',
                'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'
            ];
            return months[monthIndex];
        }
        
        // Obtener datos de categorías para gráfico circular
        function getCategoryDataForChart() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthlyExpenses = appData.transactions.filter(transaction => {
                if (transaction.type !== 'expense') return false;
                
                const date = new Date(transaction.date);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });
            
            const categoryTotals = {};
            monthlyExpenses.forEach(expense => {
                const categoryName = categoryNames[expense.category] || expense.category;
                if (!categoryTotals[categoryName]) {
                    categoryTotals[categoryName] = 0;
                }
                categoryTotals[categoryName] += expense.amount;
            });
            
            return Object.keys(categoryTotals)
                .map(category => ({
                    category: category,
                    amount: categoryTotals[category]
                }))
                .filter(item => item.amount > 0)
                .sort((a, b) => b.amount - a.amount);
        }
        
        // Obtener datos para gráfico de velas
        function getCandlestickData() {
            const dailyData = {};
            
            appData.transactions.forEach(transaction => {
                const date = new Date(transaction.date).toISOString().split('T')[0];
                
                if (!dailyData[date]) {
                    dailyData[date] = {
                        date: date,
                        income: 0,
                        expense: 0
                    };
                }
                
                if (transaction.type === 'income') {
                    dailyData[date].income += transaction.amount;
                } else {
                    dailyData[date].expense += transaction.amount;
                }
            });
            
            const dailyArray = Object.values(dailyData)
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(-10);
            
            return dailyArray.map((day, index) => {
                const balance = day.income - day.expense;
                const prevBalance = index > 0 ? 
                    (dailyArray[index-1].income - dailyArray[index-1].expense) : balance;
                
                const variation = Math.abs(balance) * 0.15;
                const open = prevBalance;
                const close = balance;
                const high = Math.max(open, close) + variation;
                const low = Math.min(open, close) - variation;
                
                return {
                    date: formatShortDate(day.date),
                    open: open,
                    high: high,
                    low: low,
                    close: close
                };
            });
        }
        
        // Formatear fecha corta para gráficos
        function formatShortDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: 'short'
            });
        }
        
        // ============================================
        // FUNCIONES DE UTILIDAD
        // ============================================
        
        // Mostrar notificación
        function showNotification(message, type) {
            notification.textContent = message;
            notification.className = `notification notification-${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Exportar datos como JSON
        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `dashboard_financiero_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Datos exportados correctamente', 'success');
        }
        
        // Reiniciar mes
        function resetMonth() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            appData.transactions = appData.transactions.filter(transaction => {
                const date = new Date(transaction.date);
                return !(date.getMonth() === currentMonth && date.getFullYear() === currentYear);
            });
            
            updateMonthlyResults();
            
            saveAppData();
            renderAll();
            showNotification('Datos del mes actual reiniciados', 'success');
        }
        
        // Limpiar todos los datos
        function clearAllData() {
            appData = {
                transactions: [],
                monthlyResults: [],
                habits: {
                    bad: defaultBadHabits,
                    good: [],
                    streak: 0,
                    lastCompletedDate: null
                },
                timeBlocks: [
                    { id: 1, startTime: "06:00", endTime: "06:30", activity: "Ejercicio", completed: false },
                    { id: 2, startTime: "06:30", endTime: "07:00", activity: "Meditación/Planificación", completed: false },
                    { id: 3, startTime: "07:00", endTime: "08:00", activity: "Desayuno y preparación", completed: false },
                    { id: 4, startTime: "08:00", endTime: "12:00", activity: "Trabajo/Estudio", completed: false },
                    { id: 5, startTime: "12:00", endTime: "13:00", activity: "Almuerzo", completed: false },
                    { id: 6, startTime: "13:00", endTime: "17:00", activity: "Trabajo/Estudio", completed: false },
                    { id: 7, startTime: "17:00", endTime: "18:00", activity: "Ejercicio/Descanso", completed: false },
                    { id: 8, startTime: "19:00", endTime: "20:00", activity: "Cena y tiempo familiar", completed: false },
                    { id: 9, startTime: "20:00", endTime: "21:00", activity: "Lectura/Estudio", completed: false },
                    { id: 10, startTime: "21:00", endTime: "22:00", activity: "Relajación/preparación para dormir", completed: false }
                ],
                lastId: {
                    transaction: 0,
                    monthlyResult: 0,
                    habit: defaultBadHabits.length,
                    timeBlock: 10
                }
            };
            
            saveAppData();
            renderAll();
            showNotification('Todos los datos han sido limpiados', 'error');
        }
        
        // ============================================
        // FUNCIONES DE ANIMACIÓN
        // ============================================
        
        // Detectar scroll para animaciones
        function initScrollAnimations() {
            const sections = document.querySelectorAll('section');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, {
                threshold: 0.15,
                rootMargin: '0px 0px -100px 0px'
            });
            
            sections.forEach(section => {
                observer.observe(section);
            });
        }
        
        // ============================================
        // FUNCIONES DE ACCIÓN PARA SUGERENCIAS
        // ============================================
        
        function showAntExpenseStrategies() {
            alert('Estrategias para reducir gastos hormiga:\n\n1. Lleva un registro diario de pequeños gastos\n2. Espera 24 horas antes de compras impulsivas\n3. Establece un presupuesto semanal para gastos menores\n4. Usa solo efectivo para gastos hormiga\n5. Identifica patrones y evita situaciones que los desencadenen');
        }
        
        function showCategoryAnalysis() {
            alert('Análisis de categorías:\n\nRevisa tu distribución de gastos en la sección "Gastos por Categoría".\nIdentifica categorías que puedan optimizarse y establece límites mensuales.');
        }
        
        function showInvestmentOptions() {
            alert('Opciones de inversión para principiantes:\n\n1. Fondos indexados de bajo costo\n2. Cuentas de ahorro de alto rendimiento\n3. Certificados de depósito (CDs)\n4. Educación financiera continua\n5. Micro-inversiones en apps especializadas');
        }
        
        function showSavingsTips() {
            alert('Consejos para aumentar tus ahorros:\n\n1. Automatiza transferencias a una cuenta de ahorros\n2. Establece metas de ahorro específicas\n3. Revisa y reduce suscripciones innecesarias\n4. Aplica la regla 50/30/20 (necesidades/deseos/ahorro)\n5. Celebra pequeños logros de ahorro');
        }
        
        function showExpenseAdjustments() {
            alert('Ajustes sugeridos para gastos:\n\n1. Revisa las 3 categorías con mayor gasto\n2. Negocia servicios (internet, celular, seguros)\n3. Cocina más en casa y reduce comida fuera\n4. Busca alternativas gratuitas de entretenimiento\n5. Planifica compras importantes con anticipación');
        }
        
        function showFinancialEducation() {
            alert('Recursos de educación financiera:\n\n1. Revisa la sección "Centro de Conocimiento"\n2. Cursos gratuitos en línea sobre finanzas\n3. Podcasts y canales de YouTube especializados\n4. Libros recomendados en la sección de conocimiento\n5. Comunidades de finanzas personales');
        }
        
        function showMealPlanning() {
            alert('Planificación de comidas para ahorrar:\n\n1. Planifica menú semanal\n2. Haz lista de compras y apégate a ella\n3. Cocina en grandes cantidades y congela\n4. Aprovecha ofertas y temporadas\n5. Reduce desperdicios usando sobras creativamente');
        }
        
        // ============================================
        // MANEJADORES DE EVENTOS
        // ============================================
        
        // Configurar todos los event listeners
        function setupEventListeners() {
            // Evento para agregar transacción
            transactionForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const type = document.querySelector('input[name="type"]:checked')?.value;
                const amount = document.getElementById('amount').value;
                const category = document.getElementById('category').value;
                const description = document.getElementById('description').value;
                const date = document.getElementById('date').value || new Date().toISOString().split('T')[0];
                
                if (!type || !amount || !category) {
                    showNotification('Por favor completa todos los campos requeridos', 'error');
                    return;
                }
                
                if (parseFloat(amount) <= 0) {
                    showNotification('El monto debe ser mayor a cero', 'error');
                    return;
                }
                
                addTransaction(type, amount, category, description, date);
                
                transactionForm.reset();
                document.getElementById('date').value = new Date().toISOString().split('T')[0];
                
                updateCharts();
                generateSmartSuggestions();
            });
            
            // Evento para agregar mal hábito
            addBadHabitBtn.addEventListener('click', () => {
                addBadHabit(newBadHabitInput.value);
            });
            
            // Evento para agregar hábito con Enter
            newBadHabitInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addBadHabit(newBadHabitInput.value);
                }
            });
            
            // Evento para mostrar sugerencias
            showSuggestionsBtn.addEventListener('click', showGoodHabitSuggestions);
            
            // Evento para agregar bloque de tiempo
            addTimeBlockBtn.addEventListener('click', addTimeBlock);
            
            // Evento para exportar datos
            exportBtn.addEventListener('click', exportData);
            
            // Evento para actualizar gráficos
            refreshChartsBtn.addEventListener('click', updateCharts);
            
            // Evento para actualizar sugerencias
            refreshSuggestionsBtn.addEventListener('click', () => {
                generateSmartSuggestions();
                showNotification('Análisis de datos completado', 'success');
            });
            
            // Evento para reiniciar mes
            clearMonthBtn.addEventListener('click', () => {
                modalMessage.textContent = '¿Estás seguro de reiniciar los datos del mes actual? Esta acción eliminará todas las transacciones del mes actual.';
                confirmationModal.style.display = 'flex';
                
                modalConfirmBtn.onclick = () => {
                    resetMonth();
                    confirmationModal.style.display = 'none';
                    updateCharts();
                    generateSmartSuggestions();
                };
            });
            
            // Evento para limpiar todos los datos
            clearAllBtn.addEventListener('click', () => {
                modalMessage.textContent = '¿Estás seguro de limpiar todos los datos? Esta acción eliminará todas las transacciones y reiniciará hábitos y plan diario.';
                confirmationModal.style.display = 'flex';
                
                modalConfirmBtn.onclick = () => {
                    clearAllData();
                    confirmationModal.style.display = 'none';
                    updateCharts();
                    generateSmartSuggestions();
                };
            });
            
            // Evento para cancelar en modal
            modalCancelBtn.addEventListener('click', () => {
                confirmationModal.style.display = 'none';
            });
            
            // Evento para agregar mes manualmente
            addMonthBtn.addEventListener('click', () => {
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                const existingMonth = appData.monthlyResults.find(r => 
                    r.month === currentMonth && r.year === currentYear
                );
                
                if (existingMonth) {
                    showNotification('Ya existe un registro para este mes', 'error');
                    return;
                }
                
                const monthIncome = calculateTotalByPeriod('income', 'month', currentMonth, currentYear);
                const monthExpense = calculateTotalByPeriod('expense', 'month', currentMonth, currentYear);
                
                appData.lastId.monthlyResult++;
                appData.monthlyResults.push({
                    id: appData.lastId.monthlyResult,
                    month: currentMonth,
                    year: currentYear,
                    income: monthIncome,
                    expense: monthExpense
                });
                
                saveAppData();
                renderMonthlyResults();
                updateCharts();
                showNotification('Mes agregado al estado de resultados', 'success');
            });
        }
        
        // ============================================
        // INICIALIZACIÓN FINAL
        // ============================================
        
        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            loadAppData();
            setupEventListeners();
            
            setTimeout(() => {
                showNotification('¡Dashboard financiero cargado exitosamente!', 'success');
            }, 1000);
        });
        
        // Hacer funciones disponibles globalmente
        window.deleteTransaction = deleteTransaction;
        window.toggleHabitCompletion = toggleHabitCompletion;
        window.deleteHabit = deleteHabit;
        window.updateTimeBlock = updateTimeBlock;
        window.toggleTimeBlockCompletion = toggleTimeBlockCompletion;
        window.deleteTimeBlock = deleteTimeBlock;
        window.showAntExpenseStrategies = showAntExpenseStrategies;
        window.showCategoryAnalysis = showCategoryAnalysis;
        window.showInvestmentOptions = showInvestmentOptions;
        window.showSavingsTips = showSavingsTips;
        window.showExpenseAdjustments = showExpenseAdjustments;
        window.showFinancialEducation = showFinancialEducation;
        window.showMealPlanning = showMealPlanning;
    </script>
    <script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("service-worker.js");
    });
  }
</script>
</body>

</html>
